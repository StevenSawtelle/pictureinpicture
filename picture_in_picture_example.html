<!DOCTYPE html>
<html>
<body>

<p>Credits: Media files are Â© copyright Blender Foundation | www.blender.org.</p>
<video id="videoElement" src="https://storage.googleapis.com/media-session/caminandes/short.mp4" controls></video>
<button id="pipButtonElement">PiP</button>
<button id="addControlsButton">Add controls</button>

<h3>Debugging Info (Useful only when Picture in Picture is active</h3>
<h1 id="widthheight">Width: 0 <br/>Height: 0</h1>
<p id="logging"></p>

<script>

	// Don"t allow PiP if not supported.
	if (!("pictureInPictureEnabled" in document) || !document.pictureInPictureEnabled) {
		// Disable PiP button so it"s not an option.
		document.getElementById("pipButtonElement").style.display = "none";
	}

	// When button clicked, if it"s already playing in PiP, stop it.
	// If it isn"t playing in PiP, start it.
  	pipButtonElement.addEventListener("click", async function() {
		if(!document.pictureInPictureElement){
			pipButtonElement.disabled = true;
			try{
	 			const pipWindow = await videoElement.requestPictureInPicture();
	 			console.log(pipWindow)
	 			// Handle resizing - nothing super interesting to do, so just log for now
	 			pipWindow.addEventListener("resize", async function(event){
					document.getElementById("widthheight").innerHTML = ("Width: " + pipWindow.width + "</br>Height: " + pipWindow.height);
				});
 			}catch(error){
 				console.log("error requesting pip: " + error);
 			}finally{
	 	 		pipButtonElement.disabled = false;
 			}
 	 	}else{
 	 		// Close PiP window.
 	 		await document.exitPictureInPicture().catch(error => {
 	 			console.log("error closing pip: " + error);
 	 		});
 	 	}
	});

  	addControlsButton.addEventListener("click", async function() {
		try{
	 		await videoElement.setPictureInPictureControls([
				{
					id: "thumbs-up",
					label: "Thumbs up",
					icons: [
						{
							src: "https://www.gstatic.com/images/icons/material/system/1x/volume_mute_black_48dp.png",
							sizes: "96x96",
							type: "image/png"
						}
					]
				},
				{
					id: "unpip",
					label: "Take away from PiP",
					icons: [
						{
							src: "https://www.gstatic.com/images/icons/material/system/1x/picture_in_picture_black_48dp.png",
							sizes: "96x96",
							type: "image/png"
						}
					]
				}
			]);
	 		}catch(error){
 				console.log("error adding controls: " + error);
 			}
	});


	videoElement.addEventListener("enterpictureinpicture", function(event) {
	  document.getElementById("logging").innerHTML += ("Entered Picture-in-Picture.<br/>");
	});

	videoElement.addEventListener("leavepictureinpicture", function(event) {
	  document.getElementById("logging").innerHTML += ("Left Picture-in-Picture.<br/>");
	});

	videoElement.addEventListener("pictureinpicturecontrolclick", function(event) {
		if(event.id == "unpip"){
			document.exitPictureInPicture().catch(error => {
 	 			console.log("error closing pip: " + error);
 	 		});
		}
	  document.getElementById("logging").innerHTML += ("Control was clicked on Picture in Picture window.<br/>");
	  document.getElementById("logging").innerHTML += ("Its id is: " + event.id + "<br/>");
});

</script>

</body>
</html>